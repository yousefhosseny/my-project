# 🔥 **شرح عميق ومبسط لـ SMB Scanning** 🔥

## ✅ **ما هو SMB؟**

**SMB (Server Message Block)** هو بروتوكول لمشاركة الملفات والطابعات بين الأجهزة في الشبكة.  
يستخدمه نظام **Windows** بشكل أساسي، لكنه متاح أيضًا على **Linux** و**macOS** عبر Samba.

### 📌 **أهم منافذ SMB:**

- **Port 445/TCP** → المنفذ الأساسي لبروتوكول SMB.
- **Port 139/TCP** → كان يُستخدم في الإصدارات القديمة من SMB.

---

## ⚠️ **لماذا يعتبر SMB خطيرًا؟**

1️⃣ إذا كان مفعّلًا بدون تأمين، يمكن لأي شخص داخل الشبكة الوصول إلى الملفات والطابعات.  
2️⃣ بعض الإصدارات القديمة مثل **SMBv1** تحتوي على ثغرات خطيرة (مثل **EternalBlue** التي استخدمتها هجمات WannaCry).  
3️⃣ يمكن استخدام SMB لجمع معلومات مثل أسماء المستخدمين والمجلدات المشتركة.

---

## 🛠️ **أدوات وأوامر فحص SMB بالتفصيل**

### 🔎 **1️⃣ اكتشاف ما إذا كان SMB يعمل على الهدف**

📌 **استخدام [[Nmap]] لفحص المنافذ 445 و 139**

```bash
nmap -p 445,139 target.com
```

**🔹 النتيجة:**  
إذا ظهر أن أحد المنافذ مفتوح، فهذا يعني أن SMB يعمل على الهدف.

#### ✅ **الخلاصة:**

SMB يعمل على **المنافذ 445 و 139**، وإذا كان أحدهما مفتوحًا، فهناك فرصة للوصول إلى الملفات المشتركة أو استغلال ثغرات.

---

### 🔎 **2️⃣ تحديد إصدار SMB ونظام التشغيل**

📌 **استخدام Nmap لجمع معلومات عن إصدار SMB والنظام**

```bash
nmap -p 445 --script=smb-os-discovery target.com
```

**🔹 النتيجة:**

- يكشف هذا الأمر عن **إصدار SMB** المستخدم.
- يحدد **نظام التشغيل** (Windows/Linux) والخدمة المشغّلة على المنفذ.

#### ✅ **الخلاصة:**

معرفة إصدار SMB مهم لتحديد ما إذا كان يحتوي على ثغرات أمنية معروفة.

---

### 🔎 **3️⃣ البحث عن الثغرات في SMB**

📌 **استخدام Nmap للبحث عن ثغرات SMB الشائعة**

```bash
nmap --script smb-vuln* -p 445 target.com
```

**🔹 النتيجة:**

- يكشف ما إذا كان النظام معرضًا لهجمات مثل **EternalBlue** (**CVE-2017-0144**).
- يعرض ثغرات أخرى مثل تسريب البيانات أو الوصول غير المصرح به.

#### ✅ **الخلاصة:**

الأنظمة التي تعمل بإصدارات قديمة من SMB، خصوصًا **SMBv1**، يمكن استغلالها لاختراق الجهاز.

---

### 🔎 **4️⃣ استكشاف الملفات المشتركة على SMB**

📌 **استخدام `[[smbclient]]` لرؤية الملفات المتاحة على الهدف**

```bash
smbclient -L \\target.com -U anonymous
```

**🔹 النتيجة:**

- يعرض قائمة بالمجلدات والملفات المشتركة إذا كان الوصول مفتوحًا.

📌 **للوصول إلى ملف مشترك:**

```bash
smbclient //target.com/share -U username
```

ثم أدخل كلمة المرور إذا كانت مطلوبة.

#### ✅ **الخلاصة:**

إذا كان SMB مفتوحًا للمستخدمين بدون كلمة مرور قوية، يمكن استغلاله للوصول إلى ملفات حساسة.

---

### 🔎 **5️⃣ تجربة تسجيل الدخول العنيف (Brute-force) على SMB**

📌 **باستخدام [[Hydra]] لتجربة كلمات مرور مختلفة على SMB**

```bash
hydra -L users.txt -P passwords.txt smb://target.com
```

**🔹 النتيجة:**

- إذا تم العثور على كلمة مرور صحيحة، يمكن تسجيل الدخول إلى SMB والوصول إلى الملفات.

#### ✅ **الخلاصة:**

SMB بدون كلمات مرور قوية معرض لهجمات التخمين، لذلك يجب استخدام كلمات مرور قوية وتفعيل الجدار الناري.

---

## 🚀 **📌 خطوات عملية لاختبار اختراق SMB (SMB Penetration Testing)**

### ✅ **1️⃣ فحص إذا كان SMB يعمل على الهدف**

```bash
nmap -p 445,139 target.com
```

### ✅ **2️⃣ معرفة إصدار SMB ونظام التشغيل**

```bash
nmap -p 445 --script=smb-os-discovery target.com
```

### ✅ **3️⃣ البحث عن ثغرات SMB مثل EternalBlue**

```bash
nmap --script smb-vuln* -p 445 target.com
```

### ✅ **4️⃣ استكشاف الملفات المشتركة**

```bash
smbclient -L \\target.com -U anonymous
```

### ✅ **5️⃣ تجربة كلمات مرور مختلفة باستخدام Hydra**

```bash
hydra -L users.txt -P passwords.txt smb://target.com
```

---

## 🔥 **📌 الخلاصة النهائية عن SMB Scanning**

1️⃣ SMB هو بروتوكول لمشاركة الملفات ولكنه قد يكون نقطة ضعف في الشبكة.  
2️⃣ إصدارات SMB القديمة مثل **SMBv1** تحتوي على ثغرات خطيرة يمكن استغلالها.  
3️⃣ يمكن اكتشاف الملفات المشتركة باستخدام `smbclient`.  
4️⃣ يمكن تجربة تسجيل الدخول باستخدام `hydra`.  
5️⃣ الحل: **تعطيل SMBv1، استخدام جدران الحماية، وكلمات مرور قوية.**

🔥 **🚀 جرب الأدوات بنفسك في بيئة اختبار قانونية واستفد منها في مجال أمن المعلومات!** 🚀