# **📡 شرح SMTP Enumeration بأبسط طريقة ممكنة**

## **📌 1. يعني إيه `SMTP`؟**

`SMTP` اختصار لـ **Simple Mail Transfer Protocol**، وهو البروتوكول المستخدم في إرسال البريد الإلكتروني بين الخوادم.

🔹 **بيشتغل على المنافذ:**

- **25** → المنفذ الأساسي لإرسال البريد (أحيانًا بيكون مفتوح للاستكشاف).
- **465** → إصدار مشفر باستخدام `SSL`.
- **587** → إصدار مشفر باستخدام `TLS`.

---

## **🔍 2. ليه بنعمل `SMTP Enumeration`؟**

لما بنختبر SMTP، هدفنا هو:  
✅ **معرفة أسماء المستخدمين الموجودين على السيرفر**.  
✅ **اكتشاف الميزات المفعلة (مثل إرسال البريد بدون توثيق - Open Relay)**.  
✅ **محاولة استغلال أي إعدادات خاطئة لاختراق السيرفر**.

🟢 **الخلاصة بالعامية المصرية:**  
بندور على **مستخدمين حقيقيين على السيرفر**، وبنشوف لو نقدر **نبعت إيميلات بدون ما يكون عندنا حساب (Open Relay)**، ولو السيرفر ضعيف، ممكن نستخدمه **للهجوم أو الاختراق**.

---

## **🚀 3. خطوات استكشاف SMTP عمليًا**

### ✅ **1. فحص وجود SMTP باستخدام `Nmap`**

```bash
nmap -p 25,465,587 --script=smtp-commands target.com
```

🔹 ده بيكشف لنا **إذا كان SMTP شغال وإيه الأوامر المدعومة عليه**.

---

### ✅ **2. معرفة الأوامر المدعومة في SMTP**

#### 📌 بنفتح اتصال مع SMTP باستخدام `Telnet`

```bash
telnet target.com 25
```

#### 📌 بعد الاتصال، نجرب نكتب:

```bash
EHLO test.com
```

🔹 هيظهر لك **قائمة بالأوامر المدعومة** زي:

```bash
250-SIZE 10485760
250-PIPELINING
250-ENHANCEDSTATUSCODES
250-STARTTLS
250-HELP
```

💡 **لو لقيت `VRFY` أو `EXPN`، ده معناه إنه ممكن نجيب أسماء المستخدمين!**

🟢 **الخلاصة بالعامية المصرية:**  
هنستخدم `telnet` علشان نتكلم مع السيرفر، ولو دعم أوامر زي `VRFY`، يبقى ممكن نجيب المستخدمين!

---

### ✅ **3. استخراج المستخدمين من SMTP**

#### 📌 **1. باستخدام `VRFY`**

```bash
VRFY admin
```

🔹 لو رجع رد زي:

```bash
250 User exists
```

يبقى المستخدم `admin` موجود!

#### 📌 **2. باستخدام `EXPN`**

```bash
EXPN mailing-list
```

🔹 ده بيكشف كل الأعضاء في **قائمة بريدية** على السيرفر.

#### 📌 **3. باستخدام `smtp-user-enum`** (أداة تلقائية)

```bash
smtp-user-enum -M VRFY -U userlist.txt -t target.com
```

🔹 الأداة دي بتجرب قائمة مستخدمين وتشوف مين موجود فعلاً.

🟢 **الخلاصة بالعامية المصرية:**  
لو السيرفر فاتح أوامر `VRFY` أو `EXPN`، **ممكن نستخدمها عشان نجيب أسماء المستخدمين** اللي عندهم إيميلات على السيرفر!

---

### ✅ **4. اختبار هل السيرفر يسمح بإرسال البريد بدون توثيق (Open Relay)**

🔹 بعد الاتصال بالسيرفر (`telnet target.com 25`)، نجرب نكتب:

```bash
MAIL FROM:<attacker@test.com>
RCPT TO:<victim@anotherdomain.com>
DATA
Hello, this is a test email.
.
```

🔹 لو السيرفر **قبل إرسال الإيميل بدون ما يطلب تسجيل دخول**، يبقى عندنا **Open Relay**، ودي ثغرة خطيرة.

🟢 **الخلاصة بالعامية المصرية:**  
لو السيرفر قبل يبعت إيميلات بدون تسجيل دخول، **ممكن أي حد يستخدمه كأداة سبام أو هجوم!**

---

## **🛠️ خطوات عملية لاختبار اختراق SMTP (SMTP Pentesting)**

### ✅ **1. فحص إذا كان SMTP شغال**

```bash
nmap -p 25,465,587 --script=smtp-commands target.com
```

### ✅ **2. استكشاف الأوامر المدعومة**

```bash
telnet target.com 25
EHLO test.com
```

### ✅ **3. البحث عن المستخدمين**

```bash
VRFY admin
EXPN mailing-list
smtp-user-enum -M VRFY -U userlist.txt -t target.com
```

### ✅ **4. اختبار `Open Relay`**

```bash
MAIL FROM:<attacker@test.com>
RCPT TO:<victim@anotherdomain.com>
DATA
Hello, this is a test email.
.
```

---

## **🔥 الخلاصة النهائية:**

1️⃣ `SMTP` هو البروتوكول المستخدم في **إرسال البريد الإلكتروني**، وأحيانًا بيكون فيه **ثغرات ممكن نستغلها**.  
2️⃣ هنستخدم `Nmap` و `Telnet` لمعرفة **إعدادات SMTP والأوامر المتاحة**.  
3️⃣ لو السيرفر بيدعم `VRFY` أو `EXPN`، **ممكن نجيب المستخدمين المسجلين عليه**.  
4️⃣ لو عنده `Open Relay`، **ممكن نستخدمه لإرسال إيميلات بدون تسجيل دخول**، ودي ثغرة خطيرة.  
5️⃣ كل الخطوات دي **مهمة لاختبار اختراق البريد الإلكتروني وتأمينه ضد الهجمات**.

🔥 **كده معاك دليل شامل لـ SMTP Enumeration وأفضل الطرق لاستكشافه واستغلاله!** 💀📧